webpackJsonp([1],{BffK:function(e,t){},ET4K:function(e,t){},"J/jO":function(e,t){},JKkS:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("xd7I"),i=n("VsiF"),s=n.n(i),l=n("vprW"),a={props:{node:Object},data:function(){return{mouseEnter:!1,stateImg:n("ZDmO")}},computed:{nodeContainerStyle:function(){return{top:this.node.top,left:this.node.left}},nodeIcoClass:function(){var e={};return e[this.node.ico]=!0,e["flow-node-drag"]=!0,e}},methods:{deleteNode:function(){this.$emit("deleteNode",this.node.id)},clickNode:function(){console.log("点击",this.node),this.$emit("clickNode",this.node.id)},changeNodePosition:function(){this.node.left==this.$refs.node.style.left&&this.node.top==this.$refs.node.style.top||this.$emit("changeNodeSite",{nodeId:this.node.id,left:this.$refs.node.style.left,top:this.$refs.node.style.top})}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"node",staticClass:"flow-node-container",style:e.nodeContainerStyle,on:{mouseenter:function(t){e.mouseEnter=!0},mouseleave:function(t){e.mouseEnter=!1},click:e.clickNode,mouseup:e.changeNodePosition}},[n("div",{staticClass:"flow-node-left"}),e._v(" "),n("div",{staticClass:"flow-node-left-ico flow-node-drag"},[n("i",{class:e.nodeIcoClass})]),e._v(" "),n("div",{staticClass:"flow-node-text",attrs:{"show-overflow-tooltip":!0}},[e._v("\n        "+e._s(e.node.name)+"\n    ")]),e._v(" "),e.mouseEnter?n("div",{staticClass:"flow-node-right-ico",on:{click:e.deleteNode}},[n("i",{staticClass:"el-icon-delete"})]):e._e()])},staticRenderFns:[]};var r=n("C7Lr")(a,d,!1,function(e){n("BffK")},null,null).exports,c={left:-1,top:-1},u={data:function(){return{activeNames:"1",draggableOptions:{preventOnFilter:!1,sort:!1,disabled:!1,ghostClass:"tt",forceFallback:!0},defaultOpeneds:["1","2"],menuList:[{id:"1",type:"group",name:"开始节点",ico:"el-icon-video-play",children:[{id:"11",type:"timer",name:"数据接入",ico:"el-icon-time",style:{}},{id:"12",type:"task",name:"接口调用",ico:"el-icon-odometer",style:{}}]},{id:"2",type:"group",name:"结束节点",ico:"el-icon-video-pause",children:[{id:"21",type:"end",name:"流程结束",ico:"el-icon-caret-right",style:{}},{id:"22",type:"over",name:"数据清理",ico:"el-icon-shopping-cart-full",style:{}}]}],nodeMenu:{}}},components:{draggable:s.a},created:function(){this.isFirefox()&&(document.body.ondrop=function(e){c.left=e.layerX,c.top=e.clientY-50,e.preventDefault(),e.stopPropagation()})},methods:{getMenu:function(e){for(var t=0;t<this.menuList.length;t++)for(var n=this.menuList[t].children,o=0;o<n.length;o++)if(n[o].type===e)return n[o]},move:function(e,t,n,o){console.log(e,t,n,o);var i=e.item.attributes.type.nodeValue;this.nodeMenu=this.getMenu(i)},end:function(e,t){this.$emit("addNode",e,this.nodeMenu,c)},isFirefox:function(){return navigator.userAgent.indexOf("Firefox")>-1}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"tool",staticClass:"flow-menu"},[n("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.menuList,function(t){return n("el-collapse-item",{key:t.id,attrs:{name:t.id}},[n("template",{slot:"title"},[e._v("\n                "+e._s(t.name)+"\n            ")]),e._v(" "),n("draggable",{attrs:{options:e.draggableOptions},on:{end:e.end,start:e.move},model:{value:t.children,callback:function(n){e.$set(t,"children",n)},expression:"menu.children"}},e._l(t.children,function(t){return n("div",{staticClass:"flow-node-menu",style:t.style,attrs:{type:t.type}},[n("div",{staticClass:"flow-node-menu-left"}),e._v(" "),n("div",{staticClass:"flow-node-menu-left-ico"},[n("i",{class:t.ico})]),e._v(" "),n("div",{staticClass:"flow-node-menu-text"},[e._v("\n                        "+e._s(t.name)+"\n                    ")])])}),0)],2)}),1)],1)},staticRenderFns:[]};var m=n("C7Lr")(u,f,!1,function(e){n("J/jO")},null,null).exports,p=n("3cXf"),h=n.n(p),v=n("2RDZ");n("k6J1");var A={props:{data:Object},data:function(){return{dialogVisible:!1,flowJsonData:{},options:{mode:{name:"javascript",json:!0},lineNumbers:!0}}},components:{codemirror:v.codemirror},methods:{init:function(){this.dialogVisible=!0,this.flowJsonData=h()(this.data,null,4).toString()}}},b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"流程数据信息",visible:e.dialogVisible,width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("codemirror",{staticClass:"code",attrs:{value:e.flowJsonData,options:e.options}})],1)},staticRenderFns:[]},g=n("C7Lr")(A,b,!1,null,null,null).exports,w=n("i7YX"),x=n.n(w),k={data:function(){return{node:{},data:{}}},methods:{init:function(e,t){var n=this;this.data=e,e.nodeList.filter(function(e){e.id===t&&(console.log(e),n.node=Object(w.cloneDeep)(e))})},reset:function(){var e=this;this.data.nodeList.filter(function(t){t.id===e.node.id&&(e.node=Object(w.cloneDeep)(t))})},save:function(){var e=this;this.data.nodeList.filter(function(t){t.id===e.node.id&&(t.name=e.node.name)})}}},C={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flow-node-form"},[n("div",{staticClass:"flow-node-form-header"},[e._v("编辑")]),e._v(" "),n("div",{staticClass:"flow-node-form-body"},[n("el-form",{ref:"dataForm",attrs:{model:e.node,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"类型"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.node.type,callback:function(t){e.$set(e.node,"type",t)},expression:"node.type"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"名称"}},[n("el-input",{model:{value:e.node.name,callback:function(t){e.$set(e.node,"name",t)},expression:"node.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"left坐标"}},[n("el-input",{model:{value:e.node.left,callback:function(t){e.$set(e.node,"left",t)},expression:"node.left"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"top坐标"}},[n("el-input",{model:{value:e.node.top,callback:function(t){e.$set(e.node,"top",t)},expression:"node.top"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"ico图标"}},[n("el-input",{model:{value:e.node.ico,callback:function(t){e.$set(e.node,"ico",t)},expression:"node.ico"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{icon:"el-icon-close"},on:{click:e.reset}},[e._v("重置")]),e._v(" "),n("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.save}},[e._v("保存")])],1)],1)],1)])},staticRenderFns:[]};var y=n("C7Lr")(k,C,!1,function(e){n("ET4K")},null,null).exports,L={name:"流程A",nodeList:[{id:"nodeA",name:"流程A-节点A",type:"task",left:"26px",top:"161px",ico:"el-icon-user-solid",show:!0},{id:"nodeB",name:"流程A-节点B",type:"task",left:"340px",top:"161px",ico:"el-icon-goods",show:!0},{id:"nodeC",name:"流程A-节点C",type:"task",left:"739px",top:"161px",ico:"el-icon-present",show:!0}],lineList:[{from:"nodeA",to:"nodeB"},{from:"nodeB",to:"nodeC"}]};var j={name:"流程B",nodeList:[{id:"nodeA",name:"流程B-节点A",type:"task",left:"18px",top:"223px",ico:"el-icon-user-solid",show:!0},{id:"nodeB",type:"task",name:"流程B-节点B",left:"351px",top:"96px",ico:"el-icon-goods",show:!0},{id:"nodeC",name:"流程B-节点C",type:"task",left:"354px",top:"351px",ico:"el-icon-present",show:!0},{id:"nodeD",name:"流程B-节点D",type:"task",left:"773px",top:"215px",ico:"el-icon-present",show:!0}],lineList:[{from:"nodeA",to:"nodeB"},{from:"nodeA",to:"nodeC"},{from:"nodeB",to:"nodeD"},{from:"nodeC",to:"nodeD"}]};function B(){return j}var D={name:"流程C",nodeList:[{id:"nodeA",name:"流程C-节点A",type:"task",left:"400px",top:"15px",ico:"el-icon-user-solid",show:!0},{id:"nodeB",name:"流程C-节点B",type:"task",left:"400px",top:"200px",ico:"el-icon-goods",show:!0},{id:"nodeC",name:"流程C-节点C",type:"task",left:"400px",top:"378px",ico:"el-icon-present",show:!0}],lineList:[{from:"nodeA",to:"nodeB"},{from:"nodeB",to:"nodeC"}]};var O={data:function(){return{jsPlumb:null,easyFlowVisible:!0,flowInfoVisible:!1,loadEasyFlowFinish:!1,data:{}}},mixins:[{data:function(){return{jsplumbSetting:{Anchors:["Top","TopCenter","TopRight","TopLeft","Right","RightMiddle","Bottom","BottomCenter","BottomRight","BottomLeft","Left","LeftMiddle"],Container:"flowContainer",Connector:"Bezier",ConnectionsDetachable:!1,DeleteEndpointsOnDetach:!1,Endpoint:["Dot",{radius:3}],EndpointStyle:{fill:"",outlineWidth:1},LogEnabled:!0,PaintStyle:{stroke:"#E0E3E7",strokeWidth:1},Overlays:[["Arrow",{width:10,length:8,location:1,foldback:.8}],["Label",{location:.1,id:"label",cssClass:"aLabel"}]],RenderMode:"svg",DragOptions:{cursor:"pointer",zIndex:2e3,hoverClass:"dropHover",activeClass:"dragActive"},scope:"green dot"},jsplumbConnectOptions:{isSource:!0,isTarget:!0,anchor:"Continuous"},jsplumbSourceOptions:{filter:".flow-node-drag",filterExclude:!1,anchor:"Continuous",allowLoopback:!1},jsplumbTargetOptions:{filter:".flow-node-drag",filterExclude:!1,anchor:"Continuous",allowLoopback:!1}}}}],components:{draggable:s.a,flowNode:r,nodeMenu:m,FlowInfo:g,FlowNodeForm:y},mounted:function(){var e=this;this.jsPlumb=l.jsPlumb.getInstance(),this.$nextTick(function(){e.dataReload(B())})},methods:{getUUID:function(){return Math.random().toString(36).substr(3,10)},jsPlumbInit:function(){var e=this;this.jsPlumb.ready(function(){e.jsPlumb.importDefaults(e.jsplumbSetting),e.jsPlumb.setSuspendDrawing(!1,!0),e.loadEasyFlow(),e.jsPlumb.bind("click",function(t,n){e.$confirm("确定删除所点击的线吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.jsPlumb.deleteConnection(t)}).catch(function(){})}),e.jsPlumb.bind("connection",function(t){var n=t.source.id,o=t.target.id;e.loadEasyFlowFinish&&e.data.lineList.push({from:n,to:o})}),e.jsPlumb.bind("connectionDetached",function(t){e.deleteLine(t.sourceId,t.targetId)}),e.jsPlumb.bind("connectionMoved",function(t){e.changeLine(t.originalSourceId,t.originalTargetId)}),e.jsPlumb.bind("contextmenu",function(e){console.log("contextmenu",e)}),e.jsPlumb.bind("beforeDrop",function(t){var n=t.sourceId,o=t.targetId;return n===o?(e.$message.error("节点不支持连接自己"),!1):e.hasLine(n,o)?(e.$message.error("该关系已存在,不允许重复创建"),!1):e.hashOppositeLine(n,o)?(e.$message.error("不支持两个节点之间连线回环"),!1):(e.$message.success("连接成功"),!0)}),e.jsPlumb.bind("beforeDetach",function(e){console.log("beforeDetach",e)})})},loadEasyFlow:function(){for(var e=0;e<this.data.nodeList.length;e++){var t=this.data.nodeList[e];this.jsPlumb.makeSource(t.id,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(t.id,this.jsplumbTargetOptions),this.jsPlumb.draggable(t.id,{containment:"parent"})}for(e=0;e<this.data.lineList.length;e++){var n=this.data.lineList[e];this.jsPlumb.connect({source:n.from,target:n.to},this.jsplumbConnectOptions)}this.$nextTick(function(){this.loadEasyFlowFinish=!0})},deleteLine:function(e,t){this.data.lineList=this.data.lineList.filter(function(n){return n.from!=e||n.to!=t})},changeLine:function(e,t){this.deleteLine(e,t)},changeNodeSite:function(e){for(var t=0;t<this.data.nodeList.length;t++){var n=this.data.nodeList[t];n.id===e.nodeId&&(n.left=e.left,n.top=e.top)}},addNode:function(e,t,n){var o=this.$refs.nodeMenu.$el.clientWidth,i=this.getUUID(),s=n.left,l=n.top;s<0&&(s=e.originalEvent.layerX-o),l<0&&(l=e.originalEvent.clientY-50);var a={id:i,name:i,type:t.type,left:s+"px",top:l+"px",ico:t.ico,show:!0};this.data.nodeList.push(a),this.$nextTick(function(){this.jsPlumb.makeSource(i,this.jsplumbSourceOptions),this.jsPlumb.makeTarget(i,this.jsplumbTargetOptions),this.jsPlumb.draggable(i,{containment:"parent"})})},deleteNode:function(e){var t=this;return this.$confirm("确定要删除节点"+e+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){t.data.nodeList=t.data.nodeList.filter(function(t){return t.id===e&&(t.show=!1),!0}),t.$nextTick(function(){this.jsPlumb.removeAllEndpoints(e)})}).catch(function(){}),!0},clickNode:function(e){console.log("点击"),this.$refs.nodeForm.init(this.data,e)},hasLine:function(e,t){for(var n=0;n<this.data.lineList.length;n++){var o=this.data.lineList[n];if(o.from===e&&o.to===t)return!0}return!1},hashOppositeLine:function(e,t){return this.hasLine(t,e)},nodeRightMenu:function(e,t){this.menu.show=!0,this.menu.curNodeId=e,this.menu.left=t.x+"px",this.menu.top=t.y+"px"},dataInfo:function(){this.flowInfoVisible=!0,this.$nextTick(function(){this.$refs.flowInfo.init()})},dataReload:function(e){var t=this;this.easyFlowVisible=!1,this.data.nodeList=[],this.data.lineList=[],this.$nextTick(function(){e=x.a.cloneDeep(e),t.easyFlowVisible=!0,t.data=e,t.$nextTick(function(){t.jsPlumb=l.jsPlumb.getInstance(),t.$nextTick(function(){t.jsPlumbInit()})})})},dataReloadA:function(){this.dataReload(L)},dataReloadB:function(){this.dataReload(B())},dataReloadC:function(){this.dataReload(D)},changeLabel:function(){this.jsPlumb.getConnections({source:"nodeA",target:"nodeB"})[0].setLabel({label:"",cssClass:"labelClass a b"})}}},_={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.easyFlowVisible?n("div",[n("el-row",[n("el-col",{attrs:{span:24}},[n("div",{staticClass:"flow-tooltar"},[n("el-link",{attrs:{type:"primary"}},[e._v(e._s(e.data.name))]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-document",size:"mini"},on:{click:e.dataInfo}},[e._v("流程信息")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.dataReloadA}},[e._v("切换流程A")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.dataReloadB}},[e._v("切换流程B")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.dataReloadC}},[e._v("切换流程C")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-edit-outline",size:"mini"},on:{click:e.changeLabel}},[e._v("设置线")])],1)])],1),e._v(" "),n("el-row",[n("el-col",{ref:"nodeMenu",attrs:{span:2}},[n("node-menu",{on:{addNode:e.addNode}})],1),e._v(" "),n("el-col",{attrs:{span:22}},[n("el-row",[n("el-col",{attrs:{span:18}},[n("div",{ref:"flowContainer",staticClass:"container",attrs:{id:"flowContainer"}},[e._l(e.data.nodeList,function(t){return[n("flow-node",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"node.show"}],attrs:{id:t.id,node:t},on:{deleteNode:e.deleteNode,changeNodeSite:e.changeNodeSite,nodeRightMenu:e.nodeRightMenu,clickNode:e.clickNode}})]})],2)]),e._v(" "),n("el-col",{attrs:{span:6}},[n("flow-node-form",{ref:"nodeForm"})],1)],1)],1)],1),e._v(" "),e.flowInfoVisible?n("flow-info",{ref:"flowInfo",attrs:{data:e.data}}):e._e()],1):e._e()},staticRenderFns:[]};var E={name:"App",components:{FlowPanel:n("C7Lr")(O,_,!1,function(e){n("OTi9")},null,null).exports}},P={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("flow-panel")],1)},staticRenderFns:[]},T=n("C7Lr")(E,P,!1,null,null,null).exports,N=n("4gzT"),F=n.n(N);n("JKkS"),n("dGyy");o.default.config.productionTip=!1,o.default.use(F.a,{size:"small"}),o.default.use(v.codemirror),new o.default({el:"#app",components:{App:T},template:"<App/>"})},OTi9:function(e,t){},ZDmO:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAAASAAAAEgARslrPgAAAuNJREFUSMdjYBhgwEhIQf3/i8UZO8XEWB7+E/gjn5fH+J2Bl1Hb1JQhlGEvQ+///+jq/x9mzP9/99QpZo3/DX8lJk+ueml4ZH7169ckO6D184W4VNOwsP+n/t9jSEhPZ/z7X5xpSlvbL1fDNRLX9u9vZGRkbGT89w/h0P//6/8zMbEcucD/bJmTE+MvBj2GD5WV/xOZ3v0LnDq19pH+tblS69YRDBKYxS17L0xLVVq0aOaMM6fTUllZSQ3a+v9XQ0JD2Nha1p2fnVq2ZEmz3EWt5GdBQQSDumXveZvUqXv3kmsxTodAza3/f+Z0WqqICEyeCcZgffxv498nubmwoE7PMDGdNfv3b3Itbpl4dlvKRAuLRkbtNavX/Pr1/xWjBeOFzk42LubL/1KyszEcwGDHsJ7BxtwcFsfkWtx8+Dxf6tKODsYKphcMFu7uMHF15ltm7z/s3fv/HMMnRisrK0wXP7mQn7Jj+3ZCPiJkccv58w/SmFtbcZqDZg8TA7GgjqmNkcXNrWXWBZlU7+5uDB/zMFxijPv7t8bQUGHW3+pqYo1FOMDmfwqjIjPzqlWrVoWGMjOjK6z5aHhkdnZTE4PHfw6GoB8/WkrOz0x9fPIksRbDzfX4f4/xBiMjpgOuMnYzxBw/fvuZqiT/dScnXAbVyBnemZ1cW8vwleEGw8LCQmJ9fPOxSp/QcVdXxk//uxmvHT2KoQCWPRDZBZJ9iI4iHGCSx+2c3G3s7C1c52tTefftq/9/NSS5V0gIpwZIARQY2Pzg/LOUG0uXwgwg1eL6//v/x//n4GiZeN4mTXzFipY/F4uT9/r6Em1As9H5/2lpAQEwl7dmXJRP+eLujiuNwMRbnc49S93k6dmy4fy+1Dv79xOymGBl1LbnlFT2SWHhf8GsSr/OZGczCDJMZ3CxsWEQZ4xkyPnzB67w5f/lDFNYWBgYGDcw+B869Ps+68V/qdOmNTJqr5lb/O4dpVFJMwAAnYpz4ehj5WwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjAtMDMtMTNUMTY6NTA6NTArMDg6MDDATSuIAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIwLTAzLTEzVDE2OjUwOjUwKzA4OjAwsRCTNAAAAFB0RVh0c3ZnOmJhc2UtdXJpAGZpbGU6Ly8vaG9tZS9hZG1pbi9pY29uLWZvbnQvdG1wL2ljb25fODdkZHIxcjM5M3kvemhlbmdxdWUteGlhbi5zdmepc45dAAAAAElFTkSuQmCC"},dGyy:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.27459f77203dc1565cf2.js.map